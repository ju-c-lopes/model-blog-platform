<!DOCTYPE html>
<html>
    <head>
        <title>YouTube Integration Test</title>
        <link
            rel="stylesheet"
            href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
        />
        <style>
            body {
                max-width: 800px;
                margin: 0 auto;
                padding: 2rem;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            }

            .media-btn {
                background-color: #264d60;
                color: white;
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                margin: 0.5rem;
                font-size: 1rem;
                transition: all 0.2s ease;
            }

            .media-btn:hover {
                background-color: #1a3a4a;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            }

            .editor-container {
                margin: 2rem 0;
                border: 2px solid #e9ecef;
                border-radius: 8px;
                overflow: hidden;
            }

            #editor {
                min-height: 300px;
            }

            .youtube-video-container {
                position: relative !important;
                margin: 1.5rem 0 !important;
                padding-bottom: 56.25% !important;
                height: 0 !important;
                overflow: hidden !important;
                background-color: #000 !important;
                border-radius: 8px !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
                transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            }

            .youtube-video-container:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2) !important;
            }

            .youtube-video-container iframe {
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                border: none !important;
                border-radius: 8px !important;
            }

            .test-section {
                background-color: #f8f9fa;
                padding: 1.5rem;
                border-radius: 8px;
                margin: 2rem 0;
            }

            .demo-video {
                margin: 1rem 0;
            }

            .success-msg {
                color: #28a745;
                font-weight: bold;
            }

            .error-msg {
                color: #dc3545;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <h1>üé• YouTube Integration Test</h1>
        <p>
            This page demonstrates the secure YouTube video integration for the
            blog editor.
        </p>

        <div class="test-section">
            <h2>üß™ Test the YouTube Button</h2>
            <button class="media-btn" onclick="insertYouTubeVideo()">
                üì∫ Add YouTube Video
            </button>
            <p><strong>Try these test URLs:</strong></p>
            <ul>
                <li>
                    <code>https://www.youtube.com/watch?v=dQw4w9WgXcQ</code>
                </li>
                <li><code>https://youtu.be/dQw4w9WgXcQ</code></li>
                <li>
                    <code>https://www.youtube.com/watch?v=jNQXAC9IVRw</code> (Me
                    at the zoo - first YouTube video)
                </li>
            </ul>
        </div>

        <div class="editor-container">
            <div id="editor"></div>
        </div>

        <div class="test-section">
            <h2>üìã Demo: Embedded YouTube Video</h2>
            <p>Here's how a YouTube video will appear in your posts:</p>

            <div class="demo-video">
                <div class="youtube-video-container">
                    <iframe
                        src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen
                        loading="lazy"
                        title="YouTube video player"
                    >
                    </iframe>
                </div>
                <p
                    style="
                        margin: 0.5rem 0;
                        font-size: 0.9em;
                        color: #666;
                        text-align: center;
                    "
                >
                    üì∫
                    <a
                        href="https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                        target="_blank"
                        rel="noopener noreferrer"
                        >View on YouTube</a
                    >
                </p>
            </div>
        </div>

        <div class="test-section">
            <h2>üîí Security Features</h2>
            <ul>
                <li>‚úÖ Uses <code>youtube-nocookie.com</code> for privacy</li>
                <li>‚úÖ Validates YouTube URL format</li>
                <li>
                    ‚úÖ Sanitizes video IDs (exactly 11 alphanumeric characters)
                </li>
                <li>‚úÖ Responsive design (16:9 aspect ratio)</li>
                <li>‚úÖ Loading="lazy" for better performance</li>
                <li>‚úÖ Proper iframe security attributes</li>
            </ul>
        </div>

        <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
        <script>
            // Initialize Quill editor
            const quill = new Quill("#editor", {
                theme: "snow",
                placeholder: "Test the YouTube integration here...",
            });

            // Make it global for the YouTube function
            window.quillEditor = quill;

            // YouTube integration function (copied from edit_post.js)
            function extractYouTubeId(url) {
                const regExp =
                    /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                return match && match[2].length === 11 ? match[2] : null;
            }

            function insertYouTubeVideo() {
                if (!window.quillEditor) return;

                const url = prompt(
                    "üé• Enter YouTube Video URL:\n\n" +
                        "Supported formats:\n" +
                        "‚Ä¢ https://www.youtube.com/watch?v=VIDEO_ID\n" +
                        "‚Ä¢ https://youtu.be/VIDEO_ID\n" +
                        "‚Ä¢ https://www.youtube.com/embed/VIDEO_ID"
                );

                if (!url || url.trim() === "") {
                    return;
                }

                const videoId = extractYouTubeId(url.trim());

                if (!videoId) {
                    alert(
                        "‚ùå Invalid YouTube URL!\n\n" +
                            "Please enter a valid YouTube URL like:\n" +
                            "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                    );
                    return;
                }

                if (!/^[a-zA-Z0-9_-]{11}$/.test(videoId)) {
                    alert("‚ùå Invalid YouTube video ID format!");
                    return;
                }

                const secureEmbedUrl = `https://www.youtube-nocookie.com/embed/${videoId}`;
                const videoHtml = `
                <div class="youtube-video-container" style="position: relative; margin: 1.5rem 0; padding-bottom: 56.25%; height: 0; overflow: hidden; background-color: #000; border-radius: 8px;">
                    <iframe 
                        src="${secureEmbedUrl}"
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen
                        loading="lazy"
                        title="YouTube video player">
                    </iframe>
                </div>
                <p style="margin: 0.5rem 0; font-size: 0.9em; color: #666; text-align: center;">
                    üì∫ <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank" rel="noopener noreferrer">View on YouTube</a>
                </p>
            `;

                const range = window.quillEditor.getSelection();
                window.quillEditor.clipboard.dangerouslyPasteHTML(
                    range ? range.index : 0,
                    videoHtml
                );

                // Show success message
                setTimeout(() => {
                    alert(
                        `‚úÖ YouTube video inserted successfully!\nVideo ID: ${videoId}`
                    );
                }, 100);

                console.log(`‚úÖ YouTube video inserted: ${videoId}`);
            }

            // Display initial message
            setTimeout(() => {
                console.log("üé• YouTube Integration Test Ready!");
                console.log(
                    "Click the 'Add YouTube Video' button to test the functionality."
                );
            }, 1000);
        </script>
    </body>
</html>
