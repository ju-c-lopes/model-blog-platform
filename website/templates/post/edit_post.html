{% extends 'base.html' %}
{% load static %}
{% block title %}
{% if is_creating %} Create New Post {% else %} Edit Post {% endif %} {% endblock %} {% block head-css %}
<link rel="stylesheet" href="{% static 'css/post.css' %}" />
<link rel="stylesheet" href="{% static 'css/edit_post.css' %}" />
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css"
/>
{% endblock %} {% block content %}
<div class="post-form-container">
    <h1 class="form-title">
        {% if is_creating %} ‚úçÔ∏è Create New Blog Post {% else %} ‚úèÔ∏è Edit Blog Post {% endif %}
    </h1>

    <form method="post" enctype="multipart/form-data" novalidate>
        {% csrf_token %}

        <div class="form-grid">
            <!-- Title Field -->
            <div class="form-group">
                <label for="{{ form.title.id_for_label }}"
                    >{{ form.title.label }}</label
                >
                {{ form.title }}
                <div class="char-counter" id="title-counter">0/200</div>
                {% if form.title.help_text %}
                <div class="help-text">{{ form.title.help_text }}</div>
                {% endif %} {% if form.title.errors %}
                <ul class="errorlist">
                    {% for error in form.title.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <!-- URL Slug Field -->
            <div class="form-group">
                <label for="{{ form.url_slug.id_for_label }}"
                    >{{ form.url_slug.label }}</label
                >
                {{ form.url_slug }} {% if form.url_slug.help_text %}
                <div class="help-text">{{ form.url_slug.help_text }}</div>
                {% endif %} {% if form.url_slug.errors %}
                <ul class="errorlist">
                    {% for error in form.url_slug.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>

            <!-- Meta Description Field -->
            <div class="form-group full-width">
                <label for="{{ form.meta_description.id_for_label }}"
                    >{{ form.meta_description.label }}</label
                >
                {{ form.meta_description }}
                <div class="char-counter" id="meta-counter">0/160</div>
                {% if form.meta_description.help_text %}
                <div class="help-text">
                    {{ form.meta_description.help_text }}
                </div>
                {% endif %} {% if form.meta_description.errors %}
                <ul class="errorlist">
                    {% for error in form.meta_description.errors %}
                    <li>{{ error }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
        </div>

        <!-- Rich Text Editor -->
        <div class="form-group full-width">
            <label for="rich-editor-container">{{ form.text.label }}</label>

            <!-- Media Upload Section -->
            <div class="media-upload-section">
                <h4 style="margin-bottom: 1rem; color: #264d60">
                    üìé Add Media
                </h4>
                <div class="media-buttons">
                    <button
                        type="button"
                        class="media-btn media-image-btn"
                        onclick="document.getElementById('image-upload').click()"
                    >
                        <i>üñºÔ∏è</i> Add Image
                    </button>
                    <button
                        type="button"
                        class="media-btn media-video-btn"
                        title="Add local video file or YouTube URL"
                    >
                        <i>üé•</i> Add Video File
                    </button>
                    <div class="video-buttons">
                        <div class="popup">
                            <div class="close-btn">X</div>
                            <div class="popup-buttons">
                                <button
                                    type="button"
                                    class="media-btn local-btn"
                                    onclick="document.getElementById('video-upload').click()"
                                    title="Add local video file (max 10MB)"
                                >
                                    <i>üé•</i> Add Video File
                                </button>
    
                                <button
                                    type="button"
                                    class="media-btn youtube-btn"
                                    onclick="insertYouTubeVideo()"
                                    title="Add YouTube video by URL"
                                >
                                    <i>üì∫</i> Add YouTube Video
                                </button>
                                <div class="youtube-form">
                                    <input
                                        type="text"
                                        id="youtube-url"
                                        placeholder="Enter YouTube URL"
                                    />
                                    <button
                                        type="button"
                                        class="media-btn"
                                        onclick="insertUrl()"
                                    >
                                        >
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button
                        type="button"
                        class="media-btn"
                        onclick="insertTable()"
                    >
                        <i>üìä</i> Insert Table
                    </button>
                    <button
                        type="button"
                        class="media-btn"
                        onclick="insertHeading()"
                    >
                        <i>üìù</i> Add Heading
                    </button>
                </div>

                <div
                    class="help-text"
                    style="
                        margin-top: 0.5rem;
                        font-size: 0.85rem;
                        color: #6c757d;
                    "
                >
                    üí° <strong>Media tips:</strong> <br />‚Ä¢ Use
                    <strong>üì∫ Add YouTube Video</strong> for YouTube links
                    <br />‚Ä¢ Use <strong>üé• Add Video File</strong> for local
                    files (max 10MB) <br />‚Ä¢ YouTube videos are embedded
                    securely and load faster
                </div>

                <!-- Hidden file inputs -->
                <input
                    type="file"
                    id="image-upload"
                    class="hidden-input"
                    accept="image/*"
                    onchange="handleImageUpload(event)"
                />
                <input
                    type="file"
                    id="video-upload"
                    class="hidden-input"
                    accept="video/*"
                    onchange="handleVideoUpload(event)"
                />

                <!-- Media preview area -->
                <div
                    id="media-preview"
                    class="media-preview"
                    style="display: none"
                ></div>
            </div>

            <!-- Rich Text Editor Container -->
            <div class="editor-container">
                <div id="rich-editor-container" style="min-height: 400px"></div>
            </div>

            <!-- Hidden textarea for form submission -->
            <textarea name="text" id="id_text" style="display: none">
{{ form.text.value|default:'' }}</textarea
            >

            {% if form.text.help_text %}
            <div class="help-text">{{ form.text.help_text }}</div>
            {% endif %} {% if form.text.errors %}
            <ul class="errorlist">
                {% for error in form.text.errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>

        <div class="form-buttons">
            {% if is_creating %}
            <a href="{% url 'home' %}" class="btn-cancel">Cancel</a>
            <button type="submit" class="btn-submit">üöÄ Publish Post</button>
            {% else %}
            <a
                href="{% url 'post_detail' url_slug=post.url_slug %}"
                class="btn-cancel"
                >Cancel</a
            >
            <button type="submit" class="btn-submit">üíæ Update Post</button>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>
<script src="{% static 'scripts/edit_post.js' %}"></script>
{% endblock %}
